atabase));
  updateStats();
}

function updateStats() {
  document.getElementById('totalCount').textContent = database.length;
}

funcent = "") {
  const txt = document.getElementById('searchTxt').value.toLowerCase();
  const dimTxt = document.getElementById('searchDim').value.replace(/[^0-9.]/g, " ").trim();
  const dimParts = dimTxt.split(/\s+/).filter(x => x);

  const filtered = database.filter(item => {
    const content = `${item.client} ${item.desc} ${item.code} ${item.remarks}`.toLowerCase();
    const matchText = content.includes(txt);
    
    let matchDim = true;
    if (dimParts.length > 0) {
      const itemDims = item.dim.replace(/[^0-9.]/g, " ").split(" ").map(Number);
      matchDim = dimParts.every(p => itemDims.some(d => Math.abs(d - p) < 0.5));
    }

    const matchClient = filterClient ? item.client === filterClient : true;
    return matchText && matchDim && matchClient;
  });

  const container = document.getElementById('mainList');
  
  if (filtered.length === 0) {
    container.innerHTML = `<div class="empty-state">${database.length === 0 ? 'ÎšÎ¬Î½Îµ Import CSV Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚!' : 'Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±'}</div>`;
    return;
  }

  container.innerHTML = filtered.slice(0, 100).map(item => `
    <div class="card">
      <div class="card-header">
        <span class="client">${item.client}</span>
        <button class="edit-btn" onclick="editItem('${item.id}')">âœï¸</button>
      </div>
      
      <div class="code-section">
        <div class="desc">${item.desc}</div>
        <div class="${item.code ? 'rubber-code' : 'rubber-code empty-code'}">
          ${item.code || "?"}
        </div>
      </div>

      <div class="details-row">
        <div class="dims">ğŸ“ ${item.dim.replace(/x/g, ' Ã— ')}</div>
        <div class="pl-code">${item.remarks}</div>
      </div>
    </div>
  `).join('');
}

function editItem(id) {
  const idx = database.findIndex(i => i.id == id);
  if (idx === -1) return;
  
  const item = database[idx];
  
  const choice = confirm(`Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚:\n\n${item.desc}\n\nÎ Î±Ï„Î®ÏƒÏ„Îµ OK Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î® Cancel Î³Î¹Î± Î´Î¹Î±Î³ÏÎ±Ï†Î®`);
  
  if (choice) {
    const newDesc = prompt("Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®:", item.desc);
    if (newDesc !== null && newDesc.trim()) item.desc = newDesc.trim();
    
    const newDim = prompt("Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚:", item.dim);
    if (newDim !== null && newDim.trim()) item.dim = newDim.trim();
    
    const newRemarks = prompt("Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚ / PL:", item.remarks);
    if (newRemarks !== null) item.remarks = newRemarks.trim();
    
    const newCode = prompt("ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ ÎšÎ±Î¿Ï…Ï„ÏƒÎ¿ÏÎº:", item.code);
    if (newCode !== null) item.code = newCode.trim();
    
    database[idx] = item;
    saveDB();
    renderList(activeClientFilter);
    alert("âœ… Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!");
  } else {
    if (confirm(`âš ï¸ Î”Î™Î‘Î“Î¡Î‘Î¦Î—\n\nÎ•Î¯ÏƒÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ:\n\n${item.desc}\nÎšÏ‰Î´Î¹ÎºÏŒÏ‚: ${item.code}`)) {
      database.splice(idx, 1);
      saveDB();
      renderFilters();
      renderList(activeClientFilter);
      alert("ğŸ—‘ï¸ Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!");
    }
  }
}

function addNewItem() {
  const client = prompt("Î ÎµÎ»Î¬Ï„Î·Ï‚:");
  if (!client) return;
  
  const desc = prompt("Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®:");
  if (!desc) return;
  
  const dim = prompt("Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ (Ï€.Ï‡. 50x20x100):");
  if (!dim) return;
  
  const remarks = prompt("Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚ / PL Code (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ):") || "";
  const code = prompt("ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ ÎšÎ±Î¿Ï…Ï„ÏƒÎ¿ÏÎº (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ):") || "";
  
  database.push({
    id: Date.now().toString(),
    client: client.trim(),
    desc: desc.trim(),
    dim: dim.trim(),
    remarks: remarks.trim(),
    code: code.trim()
  });
  
  saveDB();
  renderFilters();
  renderList(activeClientFilter);
  
  alert(`âœ… Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!\n\nÎ ÎµÎ»Î¬Ï„Î·Ï‚: ${client}\nÎ ÎµÏÎ¹Î³ÏÎ±Ï†Î®: ${desc}\nÎšÏ‰Î´Î¹ÎºÏŒÏ‚: ${code || "ÎšÎµÎ½ÏŒ"}`);
}

function renderFilters() {
  const counts = {};
  database.forEach(i => counts[i.client] = (counts[i.client] || 0) + 1);
  const clients = Object.keys(counts).sort();
  
  const html = `<button class="chip active" onclick="setFilter('')">ÎŒÎ»Î¿Î¹</button>` + 
    clients.map(c => `<button class="chip" onclick="setFilter('${c}')">${c} (${counts[c]})</button>`).join('');
    
  document.getElementById('clientFilters').innerHTML = html;
}

function setFilter(client) {
  activeClientFilter = client;
  document.querySelectorAll('.chip').forEach(btn => {
    btn.classList.toggle('active', btn.textContent.startsWith(client || "ÎŒÎ»Î¿Î¹"));
  });
  renderList(client);
}

function exportToExcel() {
  if (database.length === 0) {
    alert('âŒ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± export!');
    return;
  }
  
  let csv = "\ufeffÎ ÎµÎ»Î¬Ï„Î·Ï‚;Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®;Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚;ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ ÎšÎ±Î¿Ï…Ï„ÏƒÎ¿ÏÎº;Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÎµÎ¹Ï‚\n";
  database.forEach(i => {
    csv += `${i.client};${i.desc};${i.dim};${i.code};${i.remarks}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "E1_Rubber_List_" + new Date().toISOString().split('T')[0] + ".csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function importCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const text = e.target.result;
      const lines = text.split('\n').filter(line => line.trim());
      
      if (lines.length === 0) {
        alert('âŒ Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎ¯Î½Î±Î¹ ÎºÎµÎ½ÏŒ!');
        return;
      }
      
      let separator = ';';
      if (lines[0].includes('\t')) separator = '\t';
      else if (lines[0].includes(',') && !lines[0].includes(';')) separator = ',';
      
      const firstLine = lines[0].toLowerCase();
      const hasHeaders = firstLine.includes('Ï€ÎµÎ»Î¬Ï„') || firstLine.includes('client') || 
                         firstLine.includes('Ï€ÎµÏÎ¹Î³Ï') || firstLine.includes('desc');
      const startIndex = hasHeaders ? 1 : 0;
      
      let imported = 0;
      const newItems = [];
      
      for (let i = startIndex; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const parts = line.split(separator).map(p => p.trim().replace(/^"|"$/g, ''));
        
        if (parts.length >= 3 && parts[0] && parts[1] && parts[2]) {
          const newItem = {
            id: Date.now().toString() + '_' + imported + '_' + Math.random(),
            client: parts[0] || '',
            desc: parts[1] || '',
            dim: parts[2] || '',
            code: parts[3] || '',
            remarks: parts[4] || ''
          };
          newItems.push(newItem);
          imported++;
        }
      }
      
      if (imported > 0) {
        database = database.concat(newItems);
        saveDB();
        renderFilters();
        activeClientFilter = '';
        renderList('');
        
        alert(`âœ… Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®!\n\n${imported} ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎ±Î½.\n\nÎ£ÏÎ½Î¿Î»Î¿ ÎµÎ³Î³ÏÎ±Ï†ÏÎ½: ${database.length}`);
      } else {
        alert(`âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î­Î³ÎºÏ…ÏÎµÏ‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚!\n\nÎ”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÏ„Î®Ï‚: ${separator}\nÎ“ÏÎ±Î¼Î¼Î­Ï‚: ${lines.length}\n\nÎ Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÏƒÏ‰ÏƒÏ„Î®Ï‚ Î¼Î¿ÏÏ†Î®Ï‚:\nGAP;OCUVITE;80x40x120;407;2725A`);
      }
      
    } catch (error) {
      alert('âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·:\n\n' + error.message);
    }
  };
  
  reader.onerror = function() {
    alert('âŒ Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï…!');
  };
  
  reader.readAsText(file, 'UTF-8');
  event.target.value = '';
}

document.getElementById('searchTxt').addEventListener('input', () => renderList(activeClientFilter));
document.getElementById('searchDim').addEventListener('input', () => renderList(activeClientFilter));

initDB();
</script>
</body>
</html>
